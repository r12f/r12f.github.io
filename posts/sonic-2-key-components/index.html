<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"r12f.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="在上一篇文章中，我们简单的介绍了SONiC的基本架构，以及它的一些特点。在这篇文章中，我们来继续自上向下的来看看SONiC，更加深入一点的来了解SONiC的核心组件的构成。 1. 前置知识 这篇文章和SONiC的官方文档中会经常出现这几个词：ASIC（Application-Specific Integrated Circuit）和ASIC状态（State）。它们指的是交换机中用来进行包处理的Pi">
<meta property="og:type" content="article">
<meta property="og:title" content="SONiC学习笔记（二）：核心组件">
<meta property="og:url" content="http://r12f.com/posts/sonic-2-key-components/index.html">
<meta property="og:site_name" content="Soul Orbit">
<meta property="og:description" content="在上一篇文章中，我们简单的介绍了SONiC的基本架构，以及它的一些特点。在这篇文章中，我们来继续自上向下的来看看SONiC，更加深入一点的来了解SONiC的核心组件的构成。 1. 前置知识 这篇文章和SONiC的官方文档中会经常出现这几个词：ASIC（Application-Specific Integrated Circuit）和ASIC状态（State）。它们指的是交换机中用来进行包处理的Pi">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2023-04-29-sonic-2-key-components/sonic-arch.png">
<meta property="og:image" content="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2023-04-29-sonic-2-key-components/sonic-mgmt-framework.jpg">
<meta property="article:published_time" content="2023-04-29T15:16:37.000Z">
<meta property="article:modified_time" content="2023-04-29T22:16:37.000Z">
<meta property="article:author" content="r12f">
<meta property="article:tag" content="network">
<meta property="article:tag" content="nos">
<meta property="article:tag" content="sonic">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2023-04-29-sonic-2-key-components/sonic-arch.png">


<link rel="canonical" href="http://r12f.com/posts/sonic-2-key-components/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://r12f.com/posts/sonic-2-key-components/","path":"posts/sonic-2-key-components/","title":"SONiC学习笔记（二）：核心组件"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SONiC学习笔记（二）：核心组件 | Soul Orbit</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-20527248-4"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-20527248-4","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Soul Orbit" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Soul Orbit</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">I'll take a quiet life. A handshake of carbon monoxide.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="nav-text">1. 前置知识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">2. 数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1"><span class="nav-text">3. 服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%88%86%E7%B1%BB"><span class="nav-text">3.1. 服务分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#syncd%E6%9C%8D%E5%8A%A1"><span class="nav-text">3.1.1. *syncd服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mgrd%E6%9C%8D%E5%8A%A1"><span class="nav-text">3.1.2. *mgrd服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1"><span class="nav-text">3.1.3. 功能实现服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#orchagent%E6%9C%8D%E5%8A%A1"><span class="nav-text">3.1.4. orchagent服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#syncd%E6%9C%8D%E5%8A%A1-2"><span class="nav-text">3.1.5. syncd服务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E9%97%B4%E6%8E%A7%E5%88%B6%E6%B5%81%E5%88%86%E7%B1%BB"><span class="nav-text">3.2. 服务间控制流分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%8B%E5%8F%91"><span class="nav-text">3.2.1. 配置下发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E5%90%8C%E6%AD%A5"><span class="nav-text">3.2.2. 状态同步</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%BE%8B%E5%AD%90"><span class="nav-text">3.2.3. 具体例子</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8"><span class="nav-text">4. 容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%B9%E5%99%A8%EF%BC%9Adatabase"><span class="nav-text">4.1. 数据库容器：database</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AE%B9%E5%99%A8%EF%BC%9Aswss%EF%BC%88Switch-State-Service%EF%BC%89"><span class="nav-text">4.2. 交换机状态管理容器：swss（Switch State Service）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ASIC%E7%AE%A1%E7%90%86%E5%AE%B9%E5%99%A8%EF%BC%9Asyncd"><span class="nav-text">4.3. ASIC管理容器：syncd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%84%E7%A7%8D%E5%AE%9E%E7%8E%B0%E7%89%B9%E5%AE%9A%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="nav-text">4.4. 各种实现特定功能的容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%EF%BC%9Amgmt-framework"><span class="nav-text">4.5. 管理服务容器：mgmt-framework</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B3%E5%8F%B0%E7%9B%91%E6%8E%A7%E5%AE%B9%E5%99%A8%EF%BC%9Apmon%EF%BC%88Platform-Monitor%EF%BC%89"><span class="nav-text">4.6. 平台监控容器：pmon（Platform Monitor）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SAI"><span class="nav-text">5. SAI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-text">6. 小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">7. 参考资料</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">r12f</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">72</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/r12f" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;r12f" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.youtube.com/channel/UCeWewreVD6kJo6KWFW_ekKg" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCeWewreVD6kJo6KWFW_ekKg" rel="noopener me" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://www.qtmuniao.com/" title="https:&#x2F;&#x2F;www.qtmuniao.com&#x2F;" rel="noopener" target="_blank">青藤木鸟</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://muqix.github.io/" title="https:&#x2F;&#x2F;muqix.github.io&#x2F;" rel="noopener" target="_blank">民国文艺少女Muqi</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://wuhenqs.com/" title="http:&#x2F;&#x2F;wuhenqs.com&#x2F;" rel="noopener" target="_blank">无痕的碎碎念</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://victoryang00.cn/wordpress" title="https:&#x2F;&#x2F;victoryang00.cn&#x2F;wordpress" rel="noopener" target="_blank">victoryang</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://captdam.com/" title="https:&#x2F;&#x2F;captdam.com&#x2F;" rel="noopener" target="_blank">小明</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://r12f.com/posts/sonic-2-key-components/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="r12f">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Soul Orbit">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="SONiC学习笔记（二）：核心组件 | Soul Orbit">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SONiC学习笔记（二）：核心组件
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-04-29 08:16:37 / Modified: 15:16:37" itemprop="dateCreated datePublished" datetime="2023-04-29T08:16:37-07:00">2023-04-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/01-Binary-Life/" itemprop="url" rel="index"><span itemprop="name">01 Binary Life</span></a>
        </span>
    </span>

  
    <span id="/posts/sonic-2-key-components/" class="post-meta-item leancloud_visitors" data-flag-title="SONiC学习笔记（二）：核心组件" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/posts/sonic-2-key-components/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/sonic-2-key-components/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><a href="/posts/sonic-1-intro/">在上一篇文章中，我们简单的介绍了SONiC的基本架构，以及它的一些特点</a>。在这篇文章中，我们来继续自上向下的来看看SONiC，更加深入一点的来了解SONiC的核心组件的构成。</p>
<h2 id="前置知识">1. 前置知识</h2>
<p>这篇文章和SONiC的官方文档中会经常出现这几个词：ASIC（Application-Specific Integrated Circuit）和ASIC状态（State）。它们指的是交换机中用来进行包处理的Pipeline的状态，比如，ACL，转发方式等等，这个和其他交换机的硬件状态，比如，端口状态（端口速度，接口类型），IP信息等等硬件状态是非常不同的。如果大家有兴趣了解更深入的细节，可以先移步阅读两个相关资料：<a target="_blank" rel="noopener" href="https://github.com/opencomputeproject/SAI/wiki/SAI-APIs">SAI (Switch Abstraction Interface) API</a>和一篇RMT（Reprogrammable Match Table）的相关论文：<a target="_blank" rel="noopener" href="http://yuba.stanford.edu/~grg/docs/sdn-chip-sigcomm-2013.pdf">Forwarding Metamorphosis: Fast Programmable Match-Action Processing in Hardware for SDN</a>。这些都会对我们阅读SONiC的文档有很大的帮助。</p>
<span id="more"></span>
<p>为了方便我们的理解和阅读，我们把上一篇文章中已经放过的SONiC架构图在这里再放一次 <a target="_blank" rel="noopener" href="https://github.com/sonic-net/SONiC/wiki/Architecture">[1]</a>：</p>
<p><img src="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2023-04-29-sonic-2-key-components/sonic-arch.png" alt></p>
<h2 id="数据库">2. 数据库</h2>
<p>首先，在SONiC里面最核心的服务，自然是当之无愧的中心数据库Redis了！它的主要目的有两个：存储所有服务的配置和状态，并且为各个服务提供通信的媒介。具体的细节，我们这里不会展开，后面会用专门的文章来介绍。</p>
<p>SONiC会在Redis中创建一个名为<code>sonic-db</code>的数据库，其配置和分库信息我们可以在<code>/var/run/redis/sonic-db/database_config.json</code>中找到：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">admin@sonic:~$ <span class="built_in">cat</span> /var/run/redis/sonic-db/database_config.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;INSTANCES&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;redis&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;hostname&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;port&quot;</span>: 6379,</span><br><span class="line">            <span class="string">&quot;unix_socket_path&quot;</span>: <span class="string">&quot;/var/run/redis/redis.sock&quot;</span>,</span><br><span class="line">            <span class="string">&quot;persistence_for_warm_boot&quot;</span>: <span class="string">&quot;yes&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;DATABASES&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;APPL_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 0, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;ASIC_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 1, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;COUNTERS_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 2, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;LOGLEVEL_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 3, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;CONFIG_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 4, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;|&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;PFC_WD_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 5, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;FLEX_COUNTER_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 5, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;STATE_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 6, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;|&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;SNMP_OVERLAY_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 7, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;|&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;RESTAPI_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 8, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;|&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;GB_ASIC_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 9, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;GB_COUNTERS_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 10, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;GB_FLEX_COUNTER_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 11, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;APPL_STATE_DB&quot;</span>: &#123; <span class="string">&quot;id&quot;</span>: 14, <span class="string">&quot;separator&quot;</span>: <span class="string">&quot;:&quot;</span>, <span class="string">&quot;instance&quot;</span>: <span class="string">&quot;redis&quot;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;VERSION&quot;</span>: <span class="string">&quot;1.0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然我们可以看到SONiC中的数据库有十来个，但是我们大部分时候只需要关注以下几个最重要的数据库就可以了：</p>
<ul>
<li><strong>CONFIG_DB</strong>：ID为4，存储所有服务的<strong>配置信息</strong>，比如端口配置，VLAN配置等等。它代表着<strong>用户想要交换机达到的状态</strong>的数据模型，这也是所有CLI和外部应用程序修改配置时的主要操作对象。</li>
<li><strong>APPL_DB（Application DB）</strong>：ID为0，存储<strong>所有服务的内部状态信息</strong>。这些信息有两种：一种是各个服务在读取了CONFIG_DB的配置信息后，自己计算出来的。我们可以理解为<strong>各个服务想要交换机达到的状态</strong>（Goal State），还有一种是当最终硬件状态发生变化被写回时，有些服务会直接写回到APPL_DB，而不是我们下面马上要介绍的STATE_DB。这些信息我们可以理解为<strong>各个服务认为交换机当前的状态</strong>（Current State）。</li>
<li><strong>STATE_DB</strong>：ID为6，存储着交换机<strong>各个部件当前的状态</strong>（Current State）。当SONiC中的服务收到了STATE_DB的状态变化，但是发现和Goal State不一致的时候，SONiC就会重新下发配置，直到两者一致。（当然，对于那些回写到APPL_DB状态，服务就会监听APPL_DB的变化，而不是STATE_DB了。）</li>
<li><strong>ASIC_DB</strong>：ID为1，存储着<strong>SONiC想要交换机ASIC达到状态信息</strong>，比如，ACL，转发方式等等。和APPL_DB不同，这个数据库里面的数据模型是面向ASIC设计的，而不是面向服务抽象的。这样做的目的是为了方便各个厂商进行SAI和ASIC驱动的开发。</li>
</ul>
<blockquote>
<p>目前我的感觉是APPL_DB和STATE_DB这两个DB的设计并不是很干净，它们的职责经常重叠，不过也有可能是我理解不够深入。欢迎大家一起讨论。</p>
</blockquote>
<p>这里，我们会发现一个很直观的问题：交换机里面这么多服务，难道所有的配置和状态都放在一个数据库里面没有隔离的么？如果两个服务用了同一个Redis Key怎么办呢？这个问题非常的好，SONiC的解决也很直接，那就是在每个数据库里面继续分表！</p>
<p>我们知道Redis在每个数据库里面并没有表的概念，而是使用key-value的方式来存储数据。所以，为了进一步分表，SONiC的解决方法是将表的名字放入key中，并且使用分隔符将表和key隔开。上面的配置文件中<code>separator</code>字段就是做这个了。比如：<code>APPL_DB</code>中的<code>PORT_TABLE</code>表中的<code>Ethernet4</code>端口的状态，我们可以通过<code>PORT_TABLE:Ethernet4</code>来获取，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 0</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; hgetall PORT_TABLE:Ethernet4</span><br><span class="line"> 1) <span class="string">&quot;admin_status&quot;</span></span><br><span class="line"> 2) <span class="string">&quot;up&quot;</span></span><br><span class="line"> 3) <span class="string">&quot;alias&quot;</span></span><br><span class="line"> 4) <span class="string">&quot;Ethernet6/1&quot;</span></span><br><span class="line"> 5) <span class="string">&quot;index&quot;</span></span><br><span class="line"> 6) <span class="string">&quot;6&quot;</span></span><br><span class="line"> 7) <span class="string">&quot;lanes&quot;</span></span><br><span class="line"> 8) <span class="string">&quot;13,14,15,16&quot;</span></span><br><span class="line"> 9) <span class="string">&quot;mtu&quot;</span></span><br><span class="line">10) <span class="string">&quot;9100&quot;</span></span><br><span class="line">11) <span class="string">&quot;speed&quot;</span></span><br><span class="line">12) <span class="string">&quot;40000&quot;</span></span><br><span class="line">13) <span class="string">&quot;description&quot;</span></span><br><span class="line">14) <span class="string">&quot;&quot;</span></span><br><span class="line">15) <span class="string">&quot;oper_status&quot;</span></span><br><span class="line">16) <span class="string">&quot;up&quot;</span></span><br></pre></td></tr></table></figure>
<p>当然在SONiC中，不仅仅是数据模型，包括通信机制，都是使用类似的方法来实现“表”级别的隔离的。</p>
<h2 id="服务">3. 服务</h2>
<h3 id="服务分类">3.1. 服务分类</h3>
<p>接下来就是服务了。SONiC里面的服务（常驻进程）非常的多，有二三十种，它们会在随着交换机启动而启动，并一直保持运行，直到交换机关机。如果我们想快速掌握SONiC，一个一个服务的去了解，会很容易陷入细节的泥潭，所以，我们最好把这些服务进行一个大的分类。</p>
<blockquote>
<p>我们这里不会深入到某一个具体的服务中去，而是先从整体上来看看SONiC中的服务的结构，帮助我们建立一个整体的认识。关于各个具体的服务，如果有机会，我们会在后面的文章中再进行介绍。</p>
</blockquote>
<p>总体而言，SONiC中的服务可以分为以下几类：<code>*syncd</code>, <code>*mgrd</code>，feature实现，<code>orchagent</code>和<code>syncd</code>。</p>
<h4 id="syncd服务">3.1.1. *syncd服务</h4>
<p>这类服务名字中都以<code>syncd</code>结尾。它们做的事情都很类似：它们负责将硬件状态同步到Redis中，一般目标都以APPL_DB或者STATE_DB为主。</p>
<p>比如，<code>portsyncd</code>就是通过监听netlink的事件，将交换机中所有Port的状态同步到STATE_DB中，而<code>natsyncd</code>则是监听netlink的事件，将交换机中所有的NAT状态同步到APPL_DB中。</p>
<h4 id="mgrd服务">3.1.2. *mgrd服务</h4>
<p>这类服务名字中都以<code>mgrd</code>结尾。顾名思义，这些服务是所谓的“Manager”服务，也就是说它们负责各个硬件的配置，和<code>*syncd</code>完全相反。它们的逻辑主要有两个部分：</p>
<ol>
<li><strong>配置下发</strong>：负责读取配置文件和监听Redis中的配置和状态改变（主要是CONFIG_DB，APPL_DB和STATE_DB），然后将这些修改推送到交换机硬件中去。推送的方法有多种，取决于更新的目标是什么，可以通过更新APPL_DB并发布更新消息，或者是直接调用linux下的命令行，对系统进行修改。比如：<code>nbrmgr</code>就是监听CONFIG_DB，APPL_DB和STATE_DB中neighbor的变化，并调用netlink和command line来对neighbor和route进行修改，而<code>intfmgr</code>除了调用command line还会将一些状态更新到APPL_DB中去。</li>
<li><strong>状态同步</strong>：对于需要Reconcile的服务，<code>*mgrd</code>还会监听STATE_DB中的状态变化，如果发现硬件状态和当前期望状态不一致，就会重新发起配置流程，将硬件状态设置为期望状态。这些STATE_DB中的状态变化一般都是<code>*syncd</code>服务推送的。比如：<code>intfmgr</code>就会监听STATE_DB中，由<code>portsyncd</code>推送的，端口的Up/Down状态和MTU变化，一旦发现和其内存中保存的期望状态不一致，就会重新下发配置。</li>
</ol>
<h4 id="功能实现服务">3.1.3. 功能实现服务</h4>
<p>有一些功能并不是依靠OS本身来完成的，而是由一些特定的进程来实现的，比如BGP，或者一些外部接口。这些服务名字中经常以<code>d</code>结尾，表示deamon，比如：<code>bgpd</code>，<code>lldpd</code>，<code>snmpd</code>，<code>teamd</code>等，或者干脆就是这个功能的名字，比如：<code>fancontrol</code>。</p>
<h4 id="orchagent服务">3.1.4. orchagent服务</h4>
<p>这个是SONiC中最重要的一个服务，不像其他的服务只负责一两个特定的功能，<code>orchagent</code>作为交换机ASIC状态的编排者（orchestrator），会检查数据库中所有来自<code>*syncd</code>服务的状态，整合起来并下发给用于保存交换机ASIC配置的数据库：ASIC_DB。这些状态最后会被<code>syncd</code>接收，并调用SAI API经过各个厂商提供的SAI实现和ASIC SDK和ASIC进行交互，最终将配置下发到交换机硬件中。</p>
<h4 id="syncd服务-2">3.1.5. syncd服务</h4>
<p><code>syncd</code>服务是<code>orchagent</code>的下游，它虽然名字叫<code>syncd</code>，但是它却同时肩负着ASIC的<code>*mgrd</code>和<code>*syncd</code>的工作。</p>
<ul>
<li>首先，作为<code>*mgrd</code>，它会监听ASIC_DB的状态变化，一旦发现，就会获取其新的状态并调用SAI API，将配置下发到交换机硬件中。</li>
<li>然后，作为<code>*syncd</code>，如果ASIC发送了任何的通知给SONiC，它也会将这些通知通过消息的方式发送到Redis中，以便<code>orchagent</code>和<code>*mgrd</code>服务获取到这些变化，并进行处理。这些通知的类型我们可以在<a target="_blank" rel="noopener" href="https://github.com/sonic-net/sonic-sairedis/blob/master/syncd/SwitchNotifications.h">SwitchNotifications.h</a>中找到。</li>
</ul>
<h3 id="服务间控制流分类">3.2. 服务间控制流分类</h3>
<p>有了这些分类，我们就可以更加清晰的来理解SONiC中的服务了，而其中非常重要的就是理解服务之间的控制流。有了上面的分类，我们这里也可以把主要的控制流有分为两类：配置下发和状态同步。</p>
<h4 id="配置下发">3.2.1. 配置下发</h4>
<p>配置下发的流程一般是这样的：</p>
<ol>
<li><strong>修改配置</strong>：用户可以通过CLI或者REST API修改配置，这些配置会被写入到CONFIG_DB中并通过Redis发送更新通知。或者外部程序可以通过特定的接口，比如BGP的API，来修改配置，这种配置会通过内部的TCP Socket发送给<code>*mgrd</code>服务。</li>
<li><strong><code>*mgrd</code>下发配置</strong>：服务监听到CONFIG_DB中的配置变化，然后将这些配置推送到交换机硬件中。这里由两种主要情况（并且可以同时存在）：
<ol>
<li><strong>直接下发</strong>：
<ol>
<li><code>*mgrd</code>服务直接调用linux下的命令行，或者是通过netlink来修改系统配置</li>
<li><code>*syncd</code>服务会通过netlink或者其他方式监听到系统配置的变化，并将这些变化推送到STATE_DB或者APPL_DB中。</li>
<li><code>*mgrd</code>服务监听到STATE_DB或者APPL_DB中的配置变化，然后将这些配置和其内存中存储的配置进行比较，如果发现不一致，就会重新调用命令行或者netlink来修改系统配置，直到它们一致为止。</li>
</ol>
</li>
<li><strong>间接下发</strong>：
<ol>
<li><code>*mgrd</code>将状态推送到APPL_DB并通过Redis发送更新通知。</li>
<li><code>orchagent</code>服务监听到配置变化，然后根据所有相关的状态，计算出此时ASIC应该达到的状态，并下发到ASIC_DB中。</li>
<li><code>syncd</code>服务监听到ASIC_DB的变化，然后将这些新的配置通过统一的SAI API接口，调用ASIC Driver更新交换机ASIC中的配置。</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>配置初始化和配置下发类似，不过是在服务启动的时候读取配置文件，这里就不展开了。</p>
<h4 id="状态同步">3.2.2. 状态同步</h4>
<p>如果这个时候，出现了一些情况，比如网口坏了，ASIC中的状态变了等等，这个时候我们就需要进行状态更新和同步了。这个流程一般是这样的：</p>
<ol>
<li><strong>检测状态变化</strong>：这个状态变化主要来源于<code>*syncd</code>服务（netlink等等）和<code>syncd</code>服务（<a target="_blank" rel="noopener" href="https://github.com/sonic-net/sonic-sairedis/blob/master/syncd/SwitchNotifications.h">SAI Switch Notification</a>），这些服务在检测到变化后，会将它们发送给STATE_DB或者APPL_DB。</li>
<li><strong>处理状态变化</strong>：<code>orchagent</code>和<code>*mgrd</code>服务会监听到这些变化，然后开始处理，将新的配置重新通过命令行和netlink下发给系统，或者下发到ASIC_DB中，让<code>syncd</code>服务再次对ASIC进行更新。</li>
</ol>
<h4 id="具体例子">3.2.3. 具体例子</h4>
<p>SONiC的官方文档中给出了几个典型的控制流流转的例子，这里就不过多的展开了，有兴趣的朋友可以去这里看看：<a target="_blank" rel="noopener" href="https://github.com/sonic-net/SONiC/wiki/Architecture#sonic-subsystems-interactions">SONiC Subsystem Interactions</a>。</p>
<h2 id="容器">4. 容器</h2>
<p>然后，就是SONiC的设计中最具特色的地方：容器化。</p>
<p>从SONiC的上面的设计图中，我们可以看出来，SONiC中，所有的服务都是以容器的形式存在的。在登录进交换机之后，我们可以通过<code>docker ps</code>命令来查看当前运行的容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">admin@sonic:~$ docker ps</span><br><span class="line">CONTAINER ID   IMAGE                                COMMAND                  CREATED      STATUS        PORTS     NAMES</span><br><span class="line">ddf09928ec58   docker-snmp:latest                   <span class="string">&quot;/usr/local/bin/supe…&quot;</span>   2 days ago   Up 32 hours             snmp</span><br><span class="line">c480f3cf9dd7   docker-sonic-mgmt-framework:latest   <span class="string">&quot;/usr/local/bin/supe…&quot;</span>   2 days ago   Up 32 hours             mgmt-framework</span><br><span class="line">3655aff31161   docker-lldp:latest                   <span class="string">&quot;/usr/bin/docker-lld…&quot;</span>   2 days ago   Up 32 hours             lldp</span><br><span class="line">78f0b12ed10e   docker-platform-monitor:latest       <span class="string">&quot;/usr/bin/docker_ini…&quot;</span>   2 days ago   Up 32 hours             pmon</span><br><span class="line">f9d9bcf6c9a6   docker-router-advertiser:latest      <span class="string">&quot;/usr/bin/docker-ini…&quot;</span>   2 days ago   Up 32 hours             radv</span><br><span class="line">2e5dbee95844   docker-fpm-frr:latest                <span class="string">&quot;/usr/bin/docker_ini…&quot;</span>   2 days ago   Up 32 hours             bgp</span><br><span class="line">bdfa58009226   docker-syncd-brcm:latest             <span class="string">&quot;/usr/local/bin/supe…&quot;</span>   2 days ago   Up 32 hours             syncd</span><br><span class="line">655e550b7a1b   docker-teamd:latest                  <span class="string">&quot;/usr/local/bin/supe…&quot;</span>   2 days ago   Up 32 hours             teamd</span><br><span class="line">1bd55acc181c   docker-orchagent:latest              <span class="string">&quot;/usr/bin/docker-ini…&quot;</span>   2 days ago   Up 32 hours             swss</span><br><span class="line">bd20649228c8   docker-eventd:latest                 <span class="string">&quot;/usr/local/bin/supe…&quot;</span>   2 days ago   Up 32 hours             eventd</span><br><span class="line">b2f58447febb   docker-database:latest               <span class="string">&quot;/usr/local/bin/dock…&quot;</span>   2 days ago   Up 32 hours             database</span><br></pre></td></tr></table></figure>
<p>这里我们来简单介绍一下这些容器。</p>
<h3 id="数据库容器：database">4.1. 数据库容器：database</h3>
<p>这个容器中运行的就是我们多次提到的SONiC中的中心数据库Redis了，它里面存放着所有交换机的配置和状态信息，SONiC也是主要通过它来向各个服务提供底层的通信机制。</p>
<p>我们通过docker进入这个容器，就可以看到里面正在运行的redis进程了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">admin@sonic:~$ sudo docker <span class="built_in">exec</span> -it database bash</span><br><span class="line"></span><br><span class="line">root@sonic:/<span class="comment"># ps aux</span></span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">...</span><br><span class="line">root          82 13.7  1.7 130808 71692 pts/0    Sl   Apr26 393:27 /usr/bin/redis-server 127.0.0.1:6379</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">root@sonic:/<span class="comment"># cat /var/run/redis/redis.pid</span></span><br><span class="line">82</span><br></pre></td></tr></table></figure>
<p>那么别的容器是如何来访问这个Redis数据库的呢？答案是通过Unix Socket。我们可以在database容器中看到这个Unix Socket，它将交换机上的<code>/var/run/redis</code>目录map进database容器，让database容器可以创建这个socket：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In database container</span></span><br><span class="line">root@sonic:/<span class="comment"># ls /var/run/redis</span></span><br><span class="line">redis.pid  redis.sock  sonic-db</span><br><span class="line"></span><br><span class="line"><span class="comment"># On host</span></span><br><span class="line">admin@sonic:~$ <span class="built_in">ls</span> /var/run/redis</span><br><span class="line">redis.pid  redis.sock  sonic-db</span><br></pre></td></tr></table></figure>
<p>然后再将这个socket给map到其他的容器中，这样所有容器就都可以来访问这个中心数据库啦，比如，swss容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">admin@sonic:~$ docker inspect swss</span><br><span class="line">...</span><br><span class="line">        <span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Binds&quot;</span>: [</span><br><span class="line">                ...</span><br><span class="line">                <span class="string">&quot;/var/run/redis:/var/run/redis:rw&quot;</span>,</span><br><span class="line">                ...</span><br><span class="line">            ],</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure>
<h3 id="交换机状态管理容器：swss（Switch-State-Service）">4.2. 交换机状态管理容器：swss（Switch State Service）</h3>
<p>这个容器可以说是SONiC中最关键的容器了，<strong>它是SONiC的大脑</strong>，里面运行着大量的<code>*syncd</code>和<code>*mgrd</code>服务，用来管理交换机方方面面的配置，比如Port，neighbor，ARP，VLAN，Tunnel等等等等。另外里面还运行着上面提到的<code>orchagent</code>，用来统一处理和ASIC相关的配置和状态变化。</p>
<p>这些服务大概的功能和流程我们上面已经提过了，所以就不再赘述了。这里我们可以通过<code>ps</code>命令来看一下这个容器中运行的服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">admin@sonic:~$ docker <span class="built_in">exec</span> -it swss bash</span><br><span class="line">root@sonic:/<span class="comment"># ps aux</span></span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">...</span><br><span class="line">root          43  0.0  0.2  91016  9688 pts/0    Sl   Apr26   0:18 /usr/bin/portsyncd</span><br><span class="line">root          49  0.1  0.6 558420 27592 pts/0    Sl   Apr26   4:31 /usr/bin/orchagent -d /var/log/swss -b 8192 -s -m 00:1c:73:f2:bc:b4</span><br><span class="line">root          74  0.0  0.2  91240  9776 pts/0    Sl   Apr26   0:19 /usr/bin/coppmgrd</span><br><span class="line">root          93  0.0  0.0   4400  3432 pts/0    S    Apr26   0:09 /bin/bash /usr/bin/arp_update</span><br><span class="line">root          94  0.0  0.2  91008  8568 pts/0    Sl   Apr26   0:09 /usr/bin/neighsyncd</span><br><span class="line">root          96  0.0  0.2  91168  9800 pts/0    Sl   Apr26   0:19 /usr/bin/vlanmgrd</span><br><span class="line">root          99  0.0  0.2  91320  9848 pts/0    Sl   Apr26   0:20 /usr/bin/intfmgrd</span><br><span class="line">root         103  0.0  0.2  91136  9708 pts/0    Sl   Apr26   0:19 /usr/bin/portmgrd</span><br><span class="line">root         104  0.0  0.2  91380  9844 pts/0    Sl   Apr26   0:20 /usr/bin/buffermgrd -l /usr/share/sonic/hwsku/pg_profile_lookup.ini</span><br><span class="line">root         107  0.0  0.2  91284  9836 pts/0    Sl   Apr26   0:20 /usr/bin/vrfmgrd</span><br><span class="line">root         109  0.0  0.2  91040  8600 pts/0    Sl   Apr26   0:19 /usr/bin/nbrmgrd</span><br><span class="line">root         110  0.0  0.2  91184  9724 pts/0    Sl   Apr26   0:19 /usr/bin/vxlanmgrd</span><br><span class="line">root         112  0.0  0.2  90940  8804 pts/0    Sl   Apr26   0:09 /usr/bin/fdbsyncd</span><br><span class="line">root         113  0.0  0.2  91140  9656 pts/0    Sl   Apr26   0:20 /usr/bin/tunnelmgrd</span><br><span class="line">root         208  0.0  0.0   5772  1636 pts/0    S    Apr26   0:07 /usr/sbin/ndppd</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="ASIC管理容器：syncd">4.3. ASIC管理容器：syncd</h3>
<p>这个容器中主要是用于管理交换机上的ASIC的，里面运行着<code>syncd</code>服务。我们之前提到的各个厂商提供的SAI（Switch Abstraction Interface）和ASIC Driver都是放在这个容器中的。正是因为这个容器的存在，才使得SONiC可以支持多种不同的ASIC，而不需要修改上层的服务。换句话说，如果没有这个容器，那SONiC就是一个缸中大脑，除了一些基本的配置，其他只能靠想的，什么都干不了。</p>
<p>在syncd容器中运行的服务并不多，就是syncd，我们可以通过<code>ps</code>命令来查看，而在<code>/usr/lib</code>目录下，我们也可以找到这个为了支持ASIC而编译出来的巨大无比的SAI文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">admin@sonic:~$ docker <span class="built_in">exec</span> -it syncd bash</span><br><span class="line"></span><br><span class="line">root@sonic:/<span class="comment"># ps aux</span></span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">...</span><br><span class="line">root          20  0.0  0.0  87708  1544 pts/0    Sl   Apr26   0:00 /usr/bin/dsserve /usr/bin/syncd --diag -u -s -p /etc/sai.d/sai.profile -b /tmp/break_before_make_objects</span><br><span class="line">root          32 10.7 14.9 2724404 599408 pts/0  Sl   Apr26 386:49 /usr/bin/syncd --diag -u -s -p /etc/sai.d/sai.profile -b /tmp/break_before_make_objects</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">root@sonic:/<span class="comment"># ls -lh /usr/lib</span></span><br><span class="line">total 343M</span><br><span class="line">...</span><br><span class="line">lrwxrwxrwx 1 root root   13 Apr 25 04:38 libsai.so.1 -&gt; libsai.so.1.0</span><br><span class="line">-rw-r--r-- 1 root root 343M Feb  1 06:10 libsai.so.1.0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="各种实现特定功能的容器">4.4. 各种实现特定功能的容器</h3>
<p>SONiC中还有很多的容器是为了实现一些特定功能而存在的。这些容器一般都有着特殊的外部接口（非SONiC CLI和REST API）和实现（非OS或ASIC），比如：</p>
<ul>
<li>bgp：用来实现BGP协议（Border Gateway Protocol，边界网关协议）的容器</li>
<li>lldp：用来实现LLDP协议（Link Layer Discovery Protocol，链路层发现协议）的容器</li>
<li>teamd：用来实现Link Aggregation（链路聚合）的容器</li>
<li>snmp：用来实现SNMP协议（Simple Network Management Protocol，简单网络管理协议）的容器</li>
</ul>
<p>和SWSS类似，为了适应SONiC的架构，它们中间也都会运行着上面我们提到的那几种服务：</p>
<ul>
<li>配置管理和下发（类似<code>*mgrd</code>）：<code>lldpmgrd</code>，<code>zebra</code>（bgp）</li>
<li>状态同步（类似<code>*syncd</code>）：<code>lldpsyncd</code>，<code>fpmsyncd</code>（bgp），<code>teamsyncd</code></li>
<li>服务实现或者外部接口（<code>*d</code>）：<code>lldpd</code>，<code>bgpd</code>，<code>teamd</code>，<code>snmpd</code></li>
</ul>
<h3 id="管理服务容器：mgmt-framework">4.5. 管理服务容器：mgmt-framework</h3>
<p>我们<a href="/posts/sonic-1-intro/">在上一篇中</a>的安装部分已经看过如何使用SONiC的CLI来进行一些交换机的配置，但是在实际生产环境中，手动登录交换机使用CLI来配置所有的交换机是不现实的，所以SONiC提供了一个REST API来解决这个问题。这个REST API的实现就是在<code>mgmt-framework</code>容器中。我们可以通过<code>ps</code>命令来查看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">admin@sonic:~$ docker <span class="built_in">exec</span> -it mgmt-framework bash</span><br><span class="line">root@sonic:/<span class="comment"># ps aux</span></span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">...</span><br><span class="line">root          16  0.3  1.2 1472804 52036 pts/0   Sl   16:20   0:02 /usr/sbin/rest_server -ui /rest_ui -logtostderr -cert /tmp/cert.pem -key /tmp/key.pem</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>其实除了REST API，SONiC还可以通过其他方式来进行管理，如gNMI，这些也都是运行在这个容器中的。其整体架构如下图所示 <a target="_blank" rel="noopener" href="https://github.com/sonic-net/SONiC/blob/master/doc/mgmt/Management%20Framework.md">[7]</a>：</p>
<p><img src="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2023-04-29-sonic-2-key-components/sonic-mgmt-framework.jpg" alt></p>
<p>这里我们也可以发现，其实我们使用的CLI，底层也是通过调用这个REST API来实现的～</p>
<h3 id="平台监控容器：pmon（Platform-Monitor）">4.6. 平台监控容器：pmon（Platform Monitor）</h3>
<p>这个容器里面的服务基本都是用来监控交换机一些基础硬件的运行状态的，比如温度，电源，风扇，SFP事件等等。同样，我们可以用<code>ps</code>命令来查看这个容器中运行的服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">admin@sonic:~$ docker <span class="built_in">exec</span> -it pmon bash</span><br><span class="line">root@sonic:/<span class="comment"># ps aux</span></span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">...</span><br><span class="line">root          28  0.0  0.8  49972 33192 pts/0    S    Apr26   0:23 python3 /usr/local/bin/ledd</span><br><span class="line">root          29  0.9  1.0 278492 43816 pts/0    Sl   Apr26  34:41 python3 /usr/local/bin/xcvrd</span><br><span class="line">root          30  0.4  1.0  57660 40412 pts/0    S    Apr26  18:41 python3 /usr/local/bin/psud</span><br><span class="line">root          32  0.0  1.0  57172 40088 pts/0    S    Apr26   0:02 python3 /usr/local/bin/syseepromd</span><br><span class="line">root          33  0.0  1.0  58648 41400 pts/0    S    Apr26   0:27 python3 /usr/local/bin/thermalctld</span><br><span class="line">root          34  0.0  1.3  70044 53496 pts/0    S    Apr26   0:46 /usr/bin/python3 /usr/local/bin/pcied</span><br><span class="line">root          42  0.0  0.0  55320  1136 ?        Ss   Apr26   0:15 /usr/sbin/sensord -f daemon</span><br><span class="line">root          45  0.0  0.8  58648 32220 pts/0    S    Apr26   2:45 python3 /usr/local/bin/thermalctld</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>其中大部分的服务从名字我们就能猜出来是做什么的了，中间只有xcvrd不是那么明显，这里xcvr是transceiver的缩写，它是用来监控交换机的光模块的，比如SFP，QSFP等等。</p>
<h2 id="SAI">5. SAI</h2>
<p>最后就是SAI（Switch Abstraction Interface，交换机抽象接口）了，它是SONiC的基石，正因为有了它，SONiC才能支持多种硬件平台。我们在<a target="_blank" rel="noopener" href="https://github.com/opencomputeproject/SAI/wiki/SAI-APIs">这个SAI API的文档</a>中，可以看到它定义的所有接口。</p>
<p>上面我们提到，SAI运行在<code>syncd</code>容器中。不过和其他组件不同，它并不是一个服务，而是一个组动态链接库（.so）。在<code>syncd</code>容器中，SONiC会在启动时启动统一的<code>syncd</code>服务，而<code>syncd</code>服务会加载依赖的SAI组件。这个组件由各个厂商提供，它们会根据自己的硬件平台来实现SAI的接口，从而让SONiC可以支持多种硬件平台。</p>
<p>我们可以通过<code>ps</code>, <code>ls</code>和<code>nm</code>命令来简单的对这个进行验证：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enter into syncd container</span></span><br><span class="line">admin@sonic:~$ docker <span class="built_in">exec</span> -it syncd bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># List all processes. We will only see syncd process here.</span></span><br><span class="line">root@sonic:/<span class="comment"># ps aux</span></span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">...</span><br><span class="line">root          21  0.0  0.0  87708  1532 pts/0    Sl   16:20   0:00 /usr/bin/dsserve /usr/bin/syncd --diag -u -s -p /etc/sai.d/sai.profile -b /tmp/break_before_make_objects</span><br><span class="line">root          33 11.1 15.0 2724396 602532 pts/0  Sl   16:20  36:30 /usr/bin/syncd --diag -u -s -p /etc/sai.d/sai.profile -b /tmp/break_before_make_objects</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find all libsai*.so.* files.</span></span><br><span class="line">root@sonic:/<span class="comment"># find / -name libsai*.so.*</span></span><br><span class="line">/usr/lib/x86_64-linux-gnu/libsaimeta.so.0</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libsaimeta.so.0.0.0</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libsaimetadata.so.0.0.0</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libsairedis.so.0.0.0</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libsairedis.so.0</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libsaimetadata.so.0</span><br><span class="line">/usr/lib/libsai.so.1</span><br><span class="line">/usr/lib/libsai.so.1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy the file out of switch and check libsai.so on your own dev machine.</span></span><br><span class="line"><span class="comment"># We will see the most important SAI export functions here.</span></span><br><span class="line">$ nm -C -D ./libsai.so.1.0 &gt; ./sai-exports.txt</span><br><span class="line">$ vim sai-exports.txt</span><br><span class="line">...</span><br><span class="line">0000000006581ae0 T sai_api_initialize</span><br><span class="line">0000000006582700 T sai_api_query</span><br><span class="line">0000000006581da0 T sai_api_uninitialize</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="小结">6. 小结</h2>
<p>好了，到此我们就把所有SONiC的关键组件都简单的过完了！</p>
<p>我们能感觉到，交换机上的组件其实非常的多，而且由于SONiC中Redis的解耦，我们很难简单的对代码进行跟踪来理解服务之间的关系，这就需要我们先建立一个比较抽线的整体模型，然后再去深入的学习每个组件的细节。这也是为什么我们会这里先对每个组件都做一个点到为止的介绍。</p>
<p>后面如果有时间，我们会继续自上向下的来看各个组件的细节。由于篇幅原因，这篇文章就先到这里吧～</p>
<h2 id="参考资料">7. 参考资料</h2>
<ul>
<li>[1] <a target="_blank" rel="noopener" href="https://github.com/sonic-net/SONiC/wiki/Architecture">SONiC Architecture</a></li>
<li>[2] <a target="_blank" rel="noopener" href="https://github.com/sonic-net/SONiC/wiki/Sonic-Roadmap-Planning">SONiC Roadmap Planning</a></li>
<li>[3] <a target="_blank" rel="noopener" href="https://sonic-net.github.io/SONiC/index.html">SONiC Landing Page</a></li>
<li>[4] <a target="_blank" rel="noopener" href="https://sonic-net.github.io/SONiC/workgroups.html">SONiC Workgroups</a></li>
<li>[5] <a target="_blank" rel="noopener" href="https://sonic-net.github.io/SONiC/Supported-Devices-and-Platforms.html">SONiC Supported Devices and Platforms</a></li>
<li>[6] <a target="_blank" rel="noopener" href="https://github.com/sonic-net/SONiC/blob/master/doc/SONiC-User-Manual.md">SONiC User Manual</a></li>
<li>[7] <a target="_blank" rel="noopener" href="https://github.com/sonic-net/SONiC/blob/master/doc/mgmt/Management%20Framework.md">SONiC Management Framework</a></li>
<li>[8] <a target="_blank" rel="noopener" href="https://github.com/opencomputeproject/SAI/wiki/SAI-APIs">SAI API</a></li>
<li>[9] <a target="_blank" rel="noopener" href="http://yuba.stanford.edu/~grg/docs/sdn-chip-sigcomm-2013.pdf">Forwarding Metamorphosis: Fast Programmable Match-Action Processing in Hardware for SDN</a></li>
<li>[10] <a target="_blank" rel="noopener" href="https://github.com/sonic-net/sonic-sairedis/">Github: sonic-net/sonic-sairedis</a></li>
</ul>
<hr>
<div class="post-series"><div class="post-series-title">同系列文章：</div><ul class="post-series-list"><li class="post-series-list-item"><a href="http://r12f.com/posts/sonic-7-bgp-workflow-part-2/">SONiC学习笔记（七）：BGP工作流（下）—— BGP路由变更下发</a></li><li class="post-series-list-item"><a href="http://r12f.com/posts/sonic-6-bgp-workflow-part-1/">SONiC学习笔记（六）：BGP工作流（上）—— 命令实现与FRR</a></li><li class="post-series-list-item"><a href="http://r12f.com/posts/sonic-5-syncd-sai-workflow/">SONiC学习笔记（五）：Syncd-SAI工作流</a></li><li class="post-series-list-item"><a href="http://r12f.com/posts/sonic-4-communication/">SONiC学习笔记（四）：通信机制</a></li><li class="post-series-list-item"><a href="http://r12f.com/posts/sonic-3-code-repos/">SONiC学习笔记（三）：代码仓库</a></li><li class="post-series-list-item"><a href="http://r12f.com/posts/sonic-2-key-components/">SONiC学习笔记（二）：核心组件</a></li><li class="post-series-list-item"><a href="http://r12f.com/posts/sonic-1-intro/">SONiC学习笔记（一）：概述与安装</a></li></ul></div>
<b>原创文章，转载请标明出处：</b><a href="http://r12f.com" target="_blank">Soul Orbit</a><br><b>本文链接地址：</b><a href="http://r12f.com/posts/sonic-2-key-components/" target="_blank">SONiC学习笔记（二）：核心组件</a>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/network/" rel="tag"># network</a>
              <a href="/tags/nos/" rel="tag"># nos</a>
              <a href="/tags/sonic/" rel="tag"># sonic</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/sonic-1-intro/" rel="prev" title="SONiC学习笔记（一）：概述与安装">
                  <i class="fa fa-chevron-left"></i> SONiC学习笔记（一）：概述与安装
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/sonic-3-code-repos/" rel="next" title="SONiC学习笔记（三）：代码仓库">
                  SONiC学习笔记（三）：代码仓库 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2011 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">r12f</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js","integrity":"sha256-e0o3JYsdjqKajf9eOe22FhioYSz9WofRY4dLKo3F6do="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.2.0/wavedrom.min.js","integrity":"sha512-/ZL0uQxVV1wYyWlpO4klZ1a39eaBz4zESSamuBMaMsZ6le3YejJ07hmLlHoCTXrKz5eYtEuO5K1BcTo+lQpQJA=="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.2.0/skins/default.js","integrity":"sha512-GV5gOBpCHd3M5Af9Ooz+I9dQdwcDKPR2F8ulzCpoF4W6uwmtLTh/pT8Q1XupPmQJO+Kt88/DrIiK7PzR1YLvwQ=="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>




  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"aanH10fNtc25mqFK1gSRqjo9-gzGzoHsz","app_key":"4AhjDuBCXDyUgpY0Cvh4wEol","server_url":"https://aanh10fn.lc-cn-n1-shared.com","security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"r12f-blog","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
