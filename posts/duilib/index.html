<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"r12f.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前段时间对皮肤引擎比较感兴趣，于是在VS第一人称快的无法直视的dot大神推荐下，看了一个小巧又好用的皮肤引擎：duilib。 1. duilib简介 duilib是一个开源的DirectUI界面库，简洁但是功能强大。而且还是BSD的license，所以即便是在商业上，大家也可以安心使用。 现在大家可以从这个网站获取到他们所有的源码：http:&#x2F;&#x2F;code.google.com&#x2F;p&#x2F;duilib&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="duilib学习笔记">
<meta property="og:url" content="http://r12f.com/posts/duilib/index.html">
<meta property="og:site_name" content="Soul Orbit">
<meta property="og:description" content="前段时间对皮肤引擎比较感兴趣，于是在VS第一人称快的无法直视的dot大神推荐下，看了一个小巧又好用的皮肤引擎：duilib。 1. duilib简介 duilib是一个开源的DirectUI界面库，简洁但是功能强大。而且还是BSD的license，所以即便是在商业上，大家也可以安心使用。 现在大家可以从这个网站获取到他们所有的源码：http:&#x2F;&#x2F;code.google.com&#x2F;p&#x2F;duilib&#x2F;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2012-11-03-duilib/duilib.jpg">
<meta property="og:image" content="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2012-11-03-duilib/duilib-core.jpg">
<meta property="og:image" content="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2012-11-03-duilib/duilib-control.jpg">
<meta property="article:published_time" content="2012-11-03T02:18:26.000Z">
<meta property="article:modified_time" content="2012-11-03T09:18:26.000Z">
<meta property="article:author" content="r12f">
<meta property="article:tag" content="DirectUI">
<meta property="article:tag" content="ui">
<meta property="article:tag" content="duilib">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2012-11-03-duilib/duilib.jpg">


<link rel="canonical" href="http://r12f.com/posts/duilib/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://r12f.com/posts/duilib/","path":"posts/duilib/","title":"duilib学习笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>duilib学习笔记 | Soul Orbit</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-20527248-4"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-20527248-4","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Soul Orbit" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Soul Orbit</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">I'll take a quiet life. A handshake of carbon monoxide.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#duilib%E7%AE%80%E4%BB%8B"><span class="nav-text">1. duilib简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E5%BA%93"><span class="nav-text">2. 工具库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A7%E4%BB%B6%E5%BA%93"><span class="nav-text">3. 控件库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E4%BB%B6%E5%9F%BA%E7%B1%BB%EF%BC%9ACControlUI"><span class="nav-text">3.1. 控件基类：CControlUI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A7%E4%BB%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-text">3.1.1. 控件类型转换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E5%9F%BA%E7%B1%BB%EF%BC%9ACContainerUI"><span class="nav-text">3.2. 容器基类：CContainerUI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E4%BB%B6%E5%AE%9E%E7%8E%B0"><span class="nav-text">3.3. 控件实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%8E%A7%E4%BB%B6"><span class="nav-text">3.3.1. 基本控件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Layout"><span class="nav-text">3.3.2. Layout</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A7%E4%BB%B6%E7%BB%98%E5%88%B6"><span class="nav-text">3.3.3. 控件绘制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E4%BB%B6%E7%AE%A1%E7%90%86%EF%BC%9ACPaintManagerUI"><span class="nav-text">3.4. 控件管理：CPaintManagerUI</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E6%B5%81%E8%BD%AC"><span class="nav-text">4. 消息流转</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E5%9F%BA%E7%A1%80%E7%B1%BB%EF%BC%9ACWindowWnd"><span class="nav-text">4.1. 窗口基础类：CWindowWnd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E5%88%86%E5%8F%91"><span class="nav-text">4.2. 消息分发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Focus-Capture"><span class="nav-text">4.2.1. Focus &amp; Capture</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%B6%88%E6%81%AF%E5%88%86%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="nav-text">4.2.2. 其他消息分发方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WindowImplBase"><span class="nav-text">4.3. WindowImplBase</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E7%BB%84%E7%BB%87%E5%92%8C%E7%9A%AE%E8%82%A4%E5%8A%A0%E8%BD%BD"><span class="nav-text">5. 资源组织和皮肤加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="nav-text">6. 简单使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">7. 总结</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">r12f</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">72</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/r12f" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;r12f" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.youtube.com/channel/UCeWewreVD6kJo6KWFW_ekKg" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCeWewreVD6kJo6KWFW_ekKg" rel="noopener me" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://www.qtmuniao.com/" title="https:&#x2F;&#x2F;www.qtmuniao.com&#x2F;" rel="noopener" target="_blank">青藤木鸟</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://muqix.github.io/" title="https:&#x2F;&#x2F;muqix.github.io&#x2F;" rel="noopener" target="_blank">民国文艺少女Muqi</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://wuhenqs.com/" title="http:&#x2F;&#x2F;wuhenqs.com&#x2F;" rel="noopener" target="_blank">无痕的碎碎念</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://victoryang00.cn/wordpress" title="https:&#x2F;&#x2F;victoryang00.cn&#x2F;wordpress" rel="noopener" target="_blank">victoryang</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://captdam.com/" title="https:&#x2F;&#x2F;captdam.com&#x2F;" rel="noopener" target="_blank">小明</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://r12f.com/posts/duilib/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="r12f">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Soul Orbit">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="duilib学习笔记 | Soul Orbit">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          duilib学习笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2012-11-02 19:18:26" itemprop="dateCreated datePublished" datetime="2012-11-02T19:18:26-07:00">2012-11-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2012-11-03 02:18:26" itemprop="dateModified" datetime="2012-11-03T02:18:26-07:00">2012-11-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/01-Binary-Life/" itemprop="url" rel="index"><span itemprop="name">01 Binary Life</span></a>
        </span>
    </span>

  
    <span id="/posts/duilib/" class="post-meta-item leancloud_visitors" data-flag-title="duilib学习笔记" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/posts/duilib/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/duilib/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>前段时间对皮肤引擎比较感兴趣，于是在VS第一人称快的无法直视的<a target="_blank" rel="noopener" href="http://www.hufuman.biz/">dot</a>大神推荐下，看了一个小巧又好用的皮肤引擎：duilib。</p>
<h2 id="duilib简介">1. duilib简介</h2>
<p>duilib是一个开源的DirectUI界面库，简洁但是功能强大。而且还是BSD的license，所以即便是在商业上，大家也可以安心使用。</p>
<p>现在大家可以从这个网站获取到他们所有的源码：<a target="_blank" rel="noopener" href="http://code.google.com/p/duilib/">http://code.google.com/p/duilib/</a></p>
<p>为了让我们能更简单的了解其机制，我们按照如下顺序一步一步的来对他进行观察：</p>
<ol>
<li>工具库：用于支撑整个项目的基础</li>
<li>控件库：这是dui最关键的部分之一，相信也是大家最关注的部分之一，另外这里也来看看它是如何管理这些控件的</li>
<li>消息流转：有了控件库，我们需要将Windows窗口的原生消息流转给这些控件，另外在这里也来看看Focus，Capture等等的实现</li>
<li>资源组织和皮肤加载：有了上面所有的这些，我们再来看看它是如何自动创建皮肤的</li>
<li>简单使用：最后，来看看到底要如何使用它</li>
</ol>
<p>以下是duilib工程带的一副总体设计图，在看代码之前看看这幅图，对看代码会很有帮助。<br>
<img src="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2012-11-03-duilib/duilib.jpg" alt="duilib"></p>
<span id="more"></span>
<h2 id="工具库">2. 工具库</h2>
<p>由于duilib没有对外部的任何库进行依赖，所以在其内部实现了很多用于支撑项目的基础类，这些类分布在Util文件夹中：</p>
<ul>
<li>UI相关：CPoint / CSize / CDuiRect</li>
<li>简单容器：CStdPtrArray / CStdValArray / CStdString / CStdStringPtrMap</li>
</ul>
<p>上面这些类看名字就基本能够理解其具体的含义了，当然除了基本的基础库，还有一些和窗口使用相关的工具的封装：</p>
<ul>
<li>窗口工具：WindowImplBase，这个工具我们在这里不详述，后面会再次提到。</li>
</ul>
<h2 id="控件库">3. 控件库</h2>
<p>控件库在duilib的实现中被分为了两块：Core和Control：</p>
<ul>
<li>Core中包含的是所有控件公用的部分，里面主要是一些基类和绘制的封装。</li>
<li>Control中包含的就是各个不同的控件的行为了。</li>
</ul>
<p>Core部分和控件相关的类图非常简单：<br>
<img src="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2012-11-03-duilib/duilib-core.jpg" alt="duilib-core"></p>
<h3 id="控件基类：CControlUI">3.1. 控件基类：CControlUI</h3>
<p>CControlUI在整个控件体系中非常重要，它是所有控件的基类，也是组成控件树的基本元素，控件树中所有的节点都是一个CControlUI。</p>
<p>他基本包括了所有控件公共的属性，如：位置，大小，颜色，是否有焦点，是否被启用，等等等等。当然这个类中还提供了非常多的基础函数，用于重载来实现子控件，如获取控件名称和ClassName，是否显示，等等等等。</p>
<p>另外为了方便从XML中直接解析出控件的各个属性，这个类中还在提供了一个SetAttribute的方法，传入字符串的属性名称和值对特定的属性进行设置，内部其实就是挨个比较字符串去完成的，所以平时使用的时候就还是不要使用的比较好了，因为每个属性实际上都有特定的方法来获取和设置。</p>
<p>另外每个控件中还有几个事件管理的对象——CEventSource，这些对象会在特定的时机被触发，如OnInit，调用其中保存的各个回调函数。</p>
<h4 id="控件类型转换">3.1.1. 控件类型转换</h4>
<p>这里我们就碰到一个问题，控件树中的每一个节点都是CControlUI，但是其实这些节点可能是文字，可能是图像，也有可能是列表，那么他怎么在这些控件指针之间进行转换呢？</p>
<p>强制转型不是一个好的选择，duilib中使用的是CControlUI::GetInterface，传入一个字符串，传出指向控件的指针。类似于COM的QueryInterface。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LPVOID <span class="title">CControlUI::GetInterface</span><span class="params">(LPCTSTR pstrName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( _tcscmp(pstrName, _T(<span class="string">&quot;Control&quot;</span>)) == <span class="number">0</span> ) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="容器基类：CContainerUI">3.2. 容器基类：CContainerUI</h3>
<p>有了基本的控件基类之后，我们就需要容器来将他管理起来，这个容器就是CContainerUI，其内部用一个数组来保存所有的CControlUI的对象，后续的所有工作，就都是基于这个对象来进行的了。</p>
<p>这样在CContainerUI里面，主要实现了一下几个功能：</p>
<ul>
<li>子控件的查找：CContainerUI::FindControl</li>
<li>子控件的生命周期管理：是否销毁（在Remove的时候自动销毁） / 是否延迟销毁（交给CPaintMangerUI去一起销毁）。</li>
<li>滚动条：所有的容器都支持滚动条，在其内部会对键盘和鼠标滚轮事件进行处理（CContainerUI::DoEvent），对其内部所有的元素调整位置，最后在绘制的时候实现滚动的效果</li>
<li>绘制：由于容器中有很多元素，所以为了加快容器的绘制，绘制的时候会获取其真正需要绘制的区域，如果子控件不在此区域中，那么就不予绘制了</li>
</ul>
<h3 id="控件实现">3.3. 控件实现</h3>
<p>有了普通的基类和容器的基类之后，我们就可以在其之上搭建控件了。其类图大致如下：<br>
<img src="http://r12f-cdn.azureedge.net/r12f-assets/post_assets/2012-11-03-duilib/duilib-control.jpg" alt="duilib-control"></p>
<h4 id="基本控件">3.3.1. 基本控件</h4>
<p>duilib实现了非常多的基本控件，他们分布在Control文件夹下，每一个头文件就是一个控件，主要有：</p>
<ul>
<li>CLabelUI / CTextUI / CEditUI / CRichEditUI</li>
<li>CButtonUI / CCheckBoxUI / COptionUI (RadioButton)</li>
<li>CScrollBarUI / CProgressUI / CSliderUI</li>
<li>CListUI</li>
<li>CDateTimeUI / CActiveXUI / CWebBrowserUI</li>
</ul>
<h4 id="Layout">3.3.2. Layout</h4>
<p>除了基本控件之外，duilib为了辅助大家对界面元素进行布局，还在中间实现了专门用于Layout的元素：</p>
<ul>
<li>CChildLayoutUI</li>
<li>CHorizontalLayoutUI / CVerticalLayoutUI / CTileLayoutUI：纵向排列，横向排列格子排列</li>
<li>CTabLayoutUI：Tab</li>
</ul>
<h4 id="控件绘制">3.3.3. 控件绘制</h4>
<p>绘制控件实际上有很多代码都是可以抽取出来的，比如：九宫格拉伸图片，平铺图片等等工作，我们实际上都不需要每次都去重写。所以这部分代码被抽取出来，形成了CRenderEngine，这个类在Core/UIRender下。在这个里面，我们可以看到很多的用于绘制方法。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UILIB_API</span> CRenderEngine</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">DrawLine</span><span class="params">(HDC hDC, <span class="type">const</span> RECT&amp; rc, <span class="type">int</span> nSize, DWORD dwPenColor)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">DrawRect</span><span class="params">(HDC hDC, <span class="type">const</span> RECT&amp; rc, <span class="type">int</span> nSize, DWORD dwPenColor)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">DrawRoundRect</span><span class="params">(HDC hDC, <span class="type">const</span> RECT&amp; rc, <span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> nSize, DWORD dwPenColor)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">DrawText</span><span class="params">(HDC hDC, CPaintManagerUI* pManager, RECT&amp; rc, LPCTSTR pstrText, \</span></span></span><br><span class="line"><span class="params"><span class="function">        DWORD dwTextColor, <span class="type">int</span> iFont, UINT uStyle)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">DrawHtmlText</span><span class="params">(HDC hDC, CPaintManagerUI* pManager, RECT&amp; rc, LPCTSTR pstrText,</span></span></span><br><span class="line"><span class="params"><span class="function">        DWORD dwTextColor, RECT* pLinks, CDuiString* sLinks, <span class="type">int</span>&amp; nLinkRects, UINT uStyle)</span></span>;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="控件管理：CPaintManagerUI">3.4. 控件管理：CPaintManagerUI</h3>
<p>当所有这些基本的控件都准备好了之后，我们就只要将这些控件管理起来，这样一个基本的控件库就完成了，而这个管理就是CPaintManagerUI来负责的。</p>
<p>在duilib中，一个Windows的原生窗口和一个CPaintManagerUI一一对应。其主要负责如下几个内容，后面会分开来细说，现在先了解一个概念就行：</p>
<ul>
<li>控件管理</li>
<li>资源管理</li>
<li>转化并分发Windows原生的窗口消息</li>
</ul>
<p>为了实现上面这些功能，其中有几个用于管理控件和资源的关键的数据结构：</p>
<ul>
<li>m_pRoot：保存根控件的节点</li>
<li>m_mNameHash：保存控件名称Hash和控件对象指针的关系</li>
<li>m_mOptionGroup：保存控件相关的Group，这个Group并不是TabOrder，他用于实现Option控件</li>
<li>m_aCustomFonts：用来管理字体资源</li>
<li>m_mImageHash：用来管理图片资源</li>
</ul>
<p>这些结构基本都可以看作是一堆列表和Map，这样可以用其来实现控件和资源的管理了。</p>
<h2 id="消息流转">4. 消息流转</h2>
<p>有了控件，现在我们的问题是，如何将原生的窗口消息分发给界面中所有的控件，使其行为和原生的一样呢？</p>
<h3 id="窗口基础类：CWindowWnd">4.1. 窗口基础类：CWindowWnd</h3>
<p>在duilib中，用来表示窗口的最基础的类是CWindowWnd，在这个类中实现了如下基本的内容：</p>
<ul>
<li>原生窗口的创建（CWindowWnd::Create）</li>
<li>Subclass（CWindowWnd::Subclass）</li>
<li>最基本的消息处理函数（CWindowWnd::__WndProc）和消息分发（CWindowWnd::HandleMessage）</li>
<li>模态窗口（CWindowWnd::ShowModal）</li>
</ul>
<p>duilib通过这个类，将原生窗口的消息分发给其派生类，最后传给整个控件体系。另外在duilib中，需要进行消息处理的基本控件，都是从这个类继承出来的。</p>
<h3 id="消息分发">4.2. 消息分发</h3>
<p>一旦我们使用CWindowWnd类创建了窗口之后，消息就会通过CWindowWnd::HandleMessage进行分发，我们可以和WTL等其他的库一样，在此对原始的窗口消息进行处理。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT <span class="title">CWindowWnd::HandleMessage</span><span class="params">(UINT uMsg, WPARAM wParam, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ::<span class="built_in">CallWindowProc</span>(m_OldWndProc, m_hWnd, uMsg, wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然如果我们觉得这样麻烦，我们也可以使用CPaintManagerUI来对其进行默认处理。我们上面提到CPaintManagerUI还会对所有的控件进行管理，这样，消息就传递给了窗口内部特定的控件了。</p>
<p>这些默认处理集中在CPaintManagerUI::MessageHandler()中，其内部会对很多窗口消息进行处理，并将其分发到对应的控件上去，比如对WM_LBUTTONDOWN的处理。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_LBUTTONDOWN:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">        POINT pt = &#123; <span class="built_in">GET_X_LPARAM</span>(lParam), <span class="built_in">GET_Y_LPARAM</span>(lParam) &#125;;</span><br><span class="line">        m_ptLastMousePos = pt;</span><br><span class="line">        CControlUI* pControl = <span class="built_in">FindControl</span>(pt);</span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">        TEventUI event = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        event.Type = UIEVENT_BUTTONDOWN;</span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">        pControl-&gt;<span class="built_in">Event</span>(event);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<h4 id="Focus-Capture">4.2.1. Focus &amp; Capture</h4>
<p>通过上面这个最简单的例子，我们基本可以猜到duilib对Focus和Capture的处理方法了：用一个成员变量保存对应的控件，在消息到达时直接转发消息。</p>
<p>在CPaintMainagerUI中，大家可以找到一个成员变量：m_pFocus，这个就是用来保存焦点控件的。在WM_KEYDOWN等键盘消息发生时，duilib就会模拟Windows行为，将消息直接转给当前Focus的控件。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_KEYDOWN:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>( m_pFocus == <span class="literal">NULL</span> ) <span class="keyword">break</span>;</span><br><span class="line">        TEventUI event = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        event.Type = UIEVENT_KEYDOWN;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        m_pFocus-&gt;<span class="built_in">Event</span>(event);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<p>但是很奇怪的是，duilib里面并没有对Capture做处理，分发鼠标消息到对应的子控件上，可能是还没有完善的原因。</p>
<h4 id="其他消息分发方式">4.2.2. 其他消息分发方式</h4>
<p>除了Event以外，CPaintManagerUI还提供了其他几种用于处理消息的方法：</p>
<ul>
<li>Notifier：在窗口上处理一些控件的逻辑，可以将其看成和WM_NOTIFY差不多的功能</li>
<li>PreMessageFilter：消息预处理，这个大家肯定不陌生了。</li>
<li>PostPaint：绘制后的回调</li>
<li>TranslateAccelerator：快捷键的处理</li>
</ul>
<p>这里需要注意的是：PreMessageFilter和TranslateAccelerator是通过全局数组来实现的，这并不符合多线程的窗口编程要求，所以<strong>duilib对多线程的支持并不是很好！</strong></p>
<h3 id="WindowImplBase">4.3. WindowImplBase</h3>
<p>为了简化duilib的使用，库中提供了一个非常方便的工具：WindowImplBase。</p>
<p>这个类将常用的功能封装在其内部，比如Notifier和PreMessageFilter，并在其中提供了各种默认的虚回调函数，供派生类重载。通过这个类，我们可以非常方便的来实现一个简单的界面。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UILIB_API</span> WindowImplBase</span><br><span class="line">	: <span class="keyword">public</span> CWindowWnd</span><br><span class="line">	, <span class="keyword">public</span> CNotifyPump</span><br><span class="line">	, <span class="keyword">public</span> INotifyUI</span><br><span class="line">	, <span class="keyword">public</span> IMessageFilterUI</span><br><span class="line">	, <span class="keyword">public</span> IDialogBuilderCallback</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ......</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> UINT <span class="title">GetClassStyle</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">	<span class="comment">// ......</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> LRESULT <span class="title">OnClose</span><span class="params">(UINT <span class="comment">/*uMsg*/</span>, WPARAM <span class="comment">/*wParam*/</span>, LPARAM <span class="comment">/*lParam*/</span>, BOOL&amp; bHandled)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> LRESULT <span class="title">OnDestroy</span><span class="params">(UINT <span class="comment">/*uMsg*/</span>, WPARAM <span class="comment">/*wParam*/</span>, LPARAM <span class="comment">/*lParam*/</span>, BOOL&amp; bHandled)</span></span>;</span><br><span class="line">	<span class="comment">// ......</span></span><br></pre></td></tr></table></figure>
<h2 id="资源组织和皮肤加载">5. 资源组织和皮肤加载</h2>
<p>好了，现在我们已经有了控件管理和控件库，现在我们需要让UI框架来帮忙组织这些资源，并且自动的来帮我们创建皮肤，减少我们的开发量。</p>
<p>duilib中的皮肤文件主要有几个部分组成：</p>
<ul>
<li>xml描述文件：描述窗口中控件的布局和样式</li>
<li>各种资源如图片</li>
</ul>
<p>我们把这些资源放在一个文件夹中，这样就形成了基础的皮肤包。当然我们还可以将其组合成一个zip包，从而加快IO访问，但是修改起来就会相对麻烦。所以我们可以在debug中使用前者，而在release中使用后者。</p>
<p>我们可以在bin\skin下面找到duilib中自带demo的所有的皮肤包。</p>
<p>皮肤中，最关键的部分就是这个xml描述文件了，一个xml描述文件对应着一个窗口的信息，如：控件的类型和样式等等。为了有一个直观的印象，我截取了duilib中ListDemo的xml描述文件的一部分放在这里：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;Window caption=<span class="string">&quot;0,0,0,30&quot;</span> roundcorner=<span class="string">&quot;5,5,5,5&quot;</span> sizebox=<span class="string">&quot;4,4,4,4&quot;</span> mininfo=<span class="string">&quot;600,320&quot;</span> showdirty=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">...</span><br><span class="line">&lt;VerticalLayout bkimage=<span class="string">&quot;file=&#x27;bg.png&#x27; corner=&#x27;10,100,10,10&#x27; hole=&#x27;true&#x27;&quot;</span> bkcolor=<span class="string">&quot;#FF313C00&quot;</span>&gt;</span><br><span class="line">...</span><br><span class="line">	&lt;HorizontalLayout height=<span class="string">&quot;35&quot;</span> inset=<span class="string">&quot;0,4,0,8&quot;</span>&gt;</span><br><span class="line">		&lt;VerticalLayout inset=<span class="string">&quot;8,4,2,2&quot;</span> width=<span class="string">&quot;80&quot;</span>&gt;</span><br><span class="line">			&lt;Text text=<span class="string">&quot;Domain/ip:&quot;</span> textcolor=<span class="string">&quot;#000000&quot;</span> font=<span class="string">&quot;1&quot;</span>&gt;&lt;/Text&gt;</span><br><span class="line">		&lt;/VerticalLayout&gt;</span><br><span class="line">		&lt;VerticalLayout&gt;</span><br><span class="line">			&lt;Edit height=<span class="string">&quot;23&quot;</span> text=<span class="string">&quot;List控件添加使用案例，每行可以响应事件&quot;</span> bordercolor=<span class="string">&quot;#C6CFD8&quot;</span> name=<span class="string">&quot;input&quot;</span> bkimage=<span class="string">&quot;file=&#x27;search_bg.png&#x27; source=&#x27;0,0,258,23&#x27; corner=&#x27;1,1,1,1&#x27;&quot;</span>/&gt;</span><br><span class="line">		&lt;/VerticalLayout&gt;</span><br><span class="line">		&lt;VerticalLayout width=<span class="string">&quot;80&quot;</span>&gt;</span><br><span class="line">			&lt;Button name=<span class="string">&quot;btn&quot;</span> text=<span class="string">&quot;Search&quot;</span> font=<span class="string">&quot;0&quot;</span> <span class="type">float</span>=<span class="string">&quot;true&quot;</span> pos=<span class="string">&quot;5,0,63,23&quot;</span> maxwidth=<span class="string">&quot;63&quot;</span> maxheight=<span class="string">&quot;23&quot;</span> normalimage=<span class="string">&quot;file=&#x27;button.png&#x27; source=&#x27;0,0,63,23&#x27;&quot;</span> hotimage=<span class="string">&quot;file=&#x27;button.png&#x27; source=&#x27;0,23,63,46&#x27;&quot;</span> pushedimage=<span class="string">&quot;file=&#x27;button.png&#x27; source=&#x27;0,23,63,46&#x27;&quot;</span>/&gt;</span><br><span class="line">		&lt;/VerticalLayout&gt;</span><br><span class="line">	&lt;/HorizontalLayout&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/VerticalLayout&gt;</span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>
<p>为了通过配置文件自动创建皮肤，duilib提供了一个类：CDialogBuilder（DuiLib\Core\UIDlgBuilder.h）。</p>
<p>这个类提供了从皮肤包（文件夹和zip格式）中的xml中创建皮肤的方法：CDialogBuilder::Create。内部实际上就是一个xml的解析，依次创建各式控件。</p>
<p>除了创建控件，这个类还将一些可以复用的资源提取出来放入CPaintManagerUI中统一管理，如字体和图片等等。</p>
<h2 id="简单使用">6. 简单使用</h2>
<p>由于项目里面实在是带了太多太多的demo，而且在duilib的工程中，<strong>还有一个doc的目录，里面也非常详细的描述了要如何使用duilib来创建一个简单的工程</strong>。</p>
<p>所以关于duilib的简单使用，这里就不再详述了，这里就只列出GameDemo的main函数，这个函数非常的简单，但是已经基本可以表达了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> APIENTRY <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE <span class="comment">/*hPrevInstance*/</span>, LPSTR <span class="comment">/*lpCmdLine*/</span>, <span class="type">int</span> nCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    CPaintManagerUI::<span class="built_in">SetInstance</span>(hInstance);</span><br><span class="line">    CPaintManagerUI::<span class="built_in">SetResourcePath</span>(CPaintManagerUI::<span class="built_in">GetInstancePath</span>() + _T(<span class="string">&quot;skin&quot;</span>));</span><br><span class="line">    CPaintManagerUI::<span class="built_in">SetResourceZip</span>(_T(<span class="string">&quot;GameRes.zip&quot;</span>));</span><br><span class="line"></span><br><span class="line">    HRESULT Hr = ::<span class="built_in">CoInitialize</span>(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">FAILED</span>(Hr) ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    CGameFrameWnd* pFrame = <span class="keyword">new</span> <span class="built_in">CGameFrameWnd</span>();</span><br><span class="line">    <span class="keyword">if</span>( pFrame == <span class="literal">NULL</span> ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    pFrame-&gt;<span class="built_in">Create</span>(<span class="literal">NULL</span>, _T(<span class="string">&quot;&quot;</span>), UI_WNDSTYLE_FRAME, <span class="number">0L</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1024</span>, <span class="number">738</span>);</span><br><span class="line">    pFrame-&gt;<span class="built_in">CenterWindow</span>();</span><br><span class="line">    ::<span class="built_in">ShowWindow</span>(*pFrame, SW_SHOWMAXIMIZED);</span><br><span class="line"></span><br><span class="line">    CPaintManagerUI::<span class="built_in">MessageLoop</span>();</span><br><span class="line"></span><br><span class="line">    ::<span class="built_in">CoUninitialize</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结">7. 总结</h2>
<p>总的来说，duilib还是一个很小巧好用的皮肤引擎的，但是他仍然有其不好的地方：对多线程的支持不好，不支持动画。但是无论如何，它还是不错的，所以如果你已经看到了这里，那么接下来跑到vs里面建一个工程，玩一把才是正经事～</p>
<b>原创文章，转载请标明出处：</b><a href="http://r12f.com" target="_blank">Soul Orbit</a><br><b>本文链接地址：</b><a href="http://r12f.com/posts/duilib/" target="_blank">duilib学习笔记</a>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/DirectUI/" rel="tag"># DirectUI</a>
              <a href="/tags/ui/" rel="tag"># ui</a>
              <a href="/tags/duilib/" rel="tag"># duilib</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/the-end-of-technologies/" rel="prev" title="近期随想：科技发展的终结">
                  <i class="fa fa-chevron-left"></i> 近期随想：科技发展的终结
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/pe-file-parser-libpe-v0-1-preview/" rel="next" title="PE文件解析库 – LibPE v0.1 Preview">
                  PE文件解析库 – LibPE v0.1 Preview <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2011 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">r12f</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js","integrity":"sha256-e0o3JYsdjqKajf9eOe22FhioYSz9WofRY4dLKo3F6do="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.2.0/wavedrom.min.js","integrity":"sha512-/ZL0uQxVV1wYyWlpO4klZ1a39eaBz4zESSamuBMaMsZ6le3YejJ07hmLlHoCTXrKz5eYtEuO5K1BcTo+lQpQJA=="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.2.0/skins/default.js","integrity":"sha512-GV5gOBpCHd3M5Af9Ooz+I9dQdwcDKPR2F8ulzCpoF4W6uwmtLTh/pT8Q1XupPmQJO+Kt88/DrIiK7PzR1YLvwQ=="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>




  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"aanH10fNtc25mqFK1gSRqjo9-gzGzoHsz","app_key":"4AhjDuBCXDyUgpY0Cvh4wEol","server_url":"https://aanh10fn.lc-cn-n1-shared.com","security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"r12f-blog","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
